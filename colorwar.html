<head>
   <link rel="icon" type="image/jpeg" href="coloro.jpeg">
   <title>color war</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    body {
        font-family: Arial;
        background-color: #303036;
       color: #000000;
        font-size:18px;
        padding:1.5%;
        overflow: auto;
      transition: 200ms;
    }
    button {
      font-size: 5vmin;
      padding: 1.5vmin 3vmin;
      border-radius: 8px;
      margin: 2px;
      opacity: 0.75;
      transition: 100ms;
    }
    .small {
      font-size: 3.75vmin;
      padding: .5vmin 1.5vmin;
    }
    button:hover {
      -webkit-box-shadow: 0px 3px 15px 9px rgba(255,255,205,0.73); 
    box-shadow: 0px 3px 15px 9px rgba(255,255,205,0.73);
    }
    .you {
      opacity: 1;
    }
    input {
      font-size: 2vmin;
      padding: 0.5vmin 1vmin;
      border-radius: 8px;
      margin: 2px;
    }
    .a {
      background-color: #ff5f5f;
    }
    .b {
      background-color: #7f7fff;
    }
    .c {
      background-color: #4fff4f;
    }
    .d {
      background-color: #ffaf3f;
    }
    .e {
      background-color: #ff7fff;
    }
    .f {
      font-weight: bold;
      color: red;
    }
    .g {
      font-weight: bold;
      color: green;
    }
    .h {
      font-weight: bold;
      color: blue;
    }
    .almost {
      
      outline: 3px solid white;
    }
  </style>
</head>
    
 <button class="navbutton almost" onclick="window.open('index.html')">◀️Back</button><br>
<div style="background-color: white">This is a recreation of Color Wars from 2 Player Games by Jindoblu.<br>
  PLAYERS:<input id=a placeholder="players (1-8)" value="2"></input><br>
  BOARD SIZE:<input id=b placeholder="board size (1-14)" value="7"></input><br>
  SPREAD REQ:<input id=c placeholder="2-3: fast, 4: normal, 5-9: slower" value="4"></input><br>
   <button class="almost small" id="start_buiton" onclick="clear();">NEW GAME</button>
   <button class="almost small" id="sipit_buiton" onclick="clear();">SKIP TURN</button>
  <p id="gameinfodisp">GAME INFO:</p>
</div>
<div id="gameplay"></div>
<script>
  arena = document.getElementById("gameplay");
   const thingis = [
      "dummy",
      "RED",
      "BLUE",
      "GREEN",
      "ORANGE",
      "PINK",
      "RED TEXT",
      "GREEN TEXT",
      "BLUE TEXT",
   ];
   const thingis_backgrounds = [
      "dummy",
      "#bf0000",
      "#003fcf",
      "#00cf00",
      "#cf8f00",
      "#af00af",
      "#cf6030",
      "#80cf80",
      "#80afcf",
   ];
size = 7;
player = 1;
players_max = 4;
maxata = 5;
var players_list = [];
turn = 1;
var color = [];
var data = [];
var flagged = [];
clear();
function draw() {
  document.body.style.background = thingis_backgrounds[players_list[player]];
  arena.innerHTML = "";
  goomba = "";
  for (i=0;i<size;i++) {
  for (j=0;j<size;j++){
    if (color[j+size*i] == 1) {
      goomba = "<button class=\'a ";
    } else if (color[j+size*i] == 2) {
      goomba = "<button class=\'b ";
    } else if (color[j+size*i] == 3) {
      goomba = "<button class=\'c ";
    } else if (color[j+size*i] == 4) {
      goomba = "<button class=\'d ";
    } else if (color[j+size*i] == 5) {
      goomba = "<button class=\'e ";
    } else if (color[j+size*i] == 6) {
      goomba = "<button class=\'f ";
    } else if (color[j+size*i] == 7) {
      goomba = "<button class=\'g ";
    } else if (color[j+size*i] == 8) {
      goomba = "<button class=\'h ";
    } else if (color[j+size*i] == 0) {
      goomba = "<button class=\'";
    }
    if (data[j+size*i] >= maxata-1) {
      goomba += "almost "
    }
    if (color[j+size*i] == players_list[[player]]) {
      goomba += "you ";
    }
    if (size > 8) {
      goomba += "small ";
    }
    arena.innerHTML += goomba + "\' onclick='addis_ababa(" + (j+size*i) +")'>" + data[j+size*i] + "</button>";
  }
  arena.innerHTML += "<br>";
}
document.getElementById("gameinfodisp").innerHTML = "PLAYERS: " + players_list.length + "<br>";
for (i=0; i<players_list.length; i++) {
   document.getElementById("gameinfodisp").innerHTML += thingis[players_list[i]] + " | SCORE: " + scorecheck(i) + ",<br> ";
}
if (players_list.length > 1) {
  document.getElementById("gameinfodisp").innerHTML +="<strong>TURN: " + thingis[players_list[player]] + "</strong>";
} else {
  document.getElementById("gameinfodisp").innerHTML +="<strong>" + thingis[players_list[player]] + " WINS!!!</strong>";
}
}

timingston = 0;
timingFlag = 0;

function addis_ababa(q) {
  if (color[q] == 0 && turn <= players_max) {
    data[q] = (maxata-1);
    color[q] = players_list[player];
    turn++;
    handleTurns();
  } else if (color[q] == players_list[player] && turn > players_max) {
    data[q]++;
    color[q] = players_list[player];
    for (i=0; i<(size*size);i++) {
        if (data[i] >= maxata) {
          s = setInterval(gruau,250);
      }
    }
    if (timingston > 5) {
      clearInterval(s);
      timingston = 0;
    }
    turn++;
    handleTurns();
  }
  
  if (player > players_list.length-1) {
      player = 0;
    }
  draw();
}
function gruau() {
  timingston++;
    for (i=0; i<(size*size);i++) {
      
      if (spread_check(i,0)) {
        timingFlag = true;
      }
      if (timingFlag) {
        timingFlag = false;
        draw();
        return 0;
      }
      flagged[i] = 0;
      
    }
    if (!timingFlag || timingston > 5) {
      timingston = 0;
      clearInterval(s);
    }
    draw();
}
function handleTurns() {
  if (player > players_max - 1 || player > players_list.length-1) {
    player = 0;
  } else if (players_max > 1) {
    player = ((player+1)%players_list.length);
  }

  draw();
}
function spread_check(q) {
  if (data[q] >= maxata) {
    flagged[q] = 1;
    add(q+1,q);
    add(q-1,q);
    add(q+size,q);
    add(q-size,q);
    data[q] = 0;
    color[q]= 0;
    outcheck();
    return 1;
  }
  return 0;
}
function outcheck() {
  let modificator = 0;
  for (b=0; b<players_list.length; b++) {
    if (turn > players_max) {
  
  if (scorecheck(b) <= 0) {
    players_list = players_list.toSpliced((players_list.length+b)%players_list.length,1);
    if (player > players_list.length - 1) {
      player = 0;
    }
  }
  squares = 0;
  }
  }
    //remove player
}
function scorecheck(bs) {
  let squares = 0;
    for (ba=0; ba<(size*size); ba++) {
      if (color[ba] == players_list[bs]) {
        squares++;
    }
  }
  return squares;
}
function add(st,st1) {
  if (!flagged[st]) {
    data[st] += (data[st1]-maxata+1);

    color[st] = color[st1];
  }
}
function clear() {
  turn = 1;
  timingston = 0;
  var s;
  if (s != null) {
    clearInterval(s);
  }
  data = [
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
];  
color = [
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
];
flagged = [
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,
];

player = 0;
   players_list = [];
   turn = 1;
players_max = ((parseInt(document.getElementById("a").value)-1)%8)+1;
size = ((parseInt(document.getElementById("b").value)-1)%14)+1;
maxata = ((parseInt(document.getElementById("c").value)-2)%8)+2;
   
for (i=1; i<=players_max; i++) {
   players_list.push(i);
}
draw();
console.log(turn);
}
jae = document.getElementById("start_buiton");
jae.addEventListener("click",function() {

  clear();

});
jae2 = document.getElementById("sipit_buiton");
jae2.addEventListener("click",function() {

  handleTurns();

});
document.addEventListener("keydown",function() {
if (event.code == "KeyC") {
  clear();
}
if (event.code == "KeyZ") {
  handleTurns();
}
});
</script>











