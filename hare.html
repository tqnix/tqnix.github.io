<link rel="icon" type="image/jpeg" href="coloro.jpeg">
   <link rel="icon" type="image/jpeg" href="coloro.jpeg">
   <title>Hare (RIPOFF TURTLE)</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    body {
        font-family: Arial;
        background-color: #303036;
        color: #ffffcd;
        font-size:18px;
        padding:1.5%;
    }
    .gau {
      margin: 0;
      padding: 0;
    }
    canvas {
      right: 0px;
      top: 0px;
      position: absolute;
      pointer-events: none;
    }
  </style>
    
 
<textarea id=input rows=10 cols=50>
INIT 
GOTO 192 64 
VAR test 45.
PEN UP.
MOVE 1.
PEN DOWN.
TURN test.
REPEAT 5.
THEN MOVE 1.
PEN UP.
MOVE 1.
INC test -1.
PRINT howdy.
 </textarea>
<br>

<button onclick="save()">Save!</button>
<button onclick="load()">Load!</button>
<button onclick="toggle_output()">Toggle Output</button>
<button onclick="toggle_pointer()">Toggle Pointer</button><button onclick="delayflag = !delayflag">Toggle Delay</button><br>
<button onclick="init(); drau(); func_odometer = 0;">RESET</button>
<button onclick="parse_text()">RUN</button>
<button onclick="window.open('hare_documentation.html')">i actually need help tho</button>
<button onclick="window.open('index.html')">Back to homepage</button>
<br>
<canvas height=256 width=256 id=art style="border: 1px solid white"></canvas>
<canvas height=256 width=256 id=artf style="border: 1px solid white"></canvas>
<p>OUTPUT:<br>-------------------------------------------------------------</p>
<div id=output></div>
<script>
  const canvas2 = document.getElementById("artf");
  const ctx2 = canvas2.getContext("2d");
  const canvas = document.getElementById("art");
const ctx = canvas.getContext("2d");
ctx.fillStyle = "#d8e0d0";
ctx.fillRect(0,0,256,256);
var pen = {
  x:128,y:128,th:0,down:true,//style:"black"
}
var the = [
  {page:"test",word:0},
  {page:"func-ct",word:0},
];
var qz = "";
var func_odometer = 0;
var waitflag = 100;
var delayflag = false;
var thing_counter = 0;
function save() {
  localStorage.savedcode2 = document.getElementById("input").value;
 }
 function load() {
   document.getElementById("input").value = localStorage.savedcode2;
 }
function parse_text() {
 localStorage.savedcode = document.getElementById("output").innerText;
  document.getElementById("output").innerText = "";
  qz = document.getElementById("input").value;
   bal = qz.replaceAll("\n","").split('.');
   
    for (var i=0; i<bal.length; i++) {
    bal2 = bal[i].replace('.','').split(' ');
      turn_that_shit_into_code(parse_line(i),i);
      //document.getElementById("output").innerText += "\n" + "-------------------------\n";
    }
}
function parse_line(f) {
  let outputAsString = "";
    for (var i=0; i<bal2.length; i++) {
      outputAsString += bal2[i] + " | ";
    }
  //document.getElementById("output").innerText += outputAsString;
  //console.log(bal2);
 let b = bal[f].replace('.','').split(' ');
  return b;
}
function HandleError(lentil,token) {
  let err;
  switch(lentil) {
    case "GENERAL":
      err = "An unspecified error has occurred";
    break;
  }
  err += " | Location: Token" + token;
}
async function turn_that_shit_into_code(arraygoeshere,j) {//j = current line of code
  for (var fjdsa = 0; fjdsa < arraygoeshere.length; fjdsa++) {
      fakevar("func-ct",1,"inc");
      fakevar("px",pen.x,"is");
      fakevar("py",pen.y,"is");
      func_odometer++;
      if (waitflag) {
        await new Promise(r => setTimeout(r, waitflag));
        //console.log("books");
        waitflag = 0;
      }
    switch(arraygoeshere[fjdsa]) {
      case "INIT":
        if (func_odometer > 1) {
          fjdsa = 10000;
        } 
      break;
      case "MOVE": 
        move(mafs(arraygoeshere[fjdsa+1]));
        document.getElementById("output").innerText +=("\nMoved " + mafs(arraygoeshere[fjdsa+1]));
      break;
      case "TURN": 
        turn(mafs(arraygoeshere[fjdsa+1]));
        document.getElementById("output").innerText +=("\nTurned " + mafs(arraygoeshere[fjdsa+1]) + " deg.");
      break;
      case "PEN": //subfunction (PEN STYLE, PEN LINE, PEN UP, PEN DOWN, ETC)
        rin(arraygoeshere[fjdsa+1]);
        document.getElementById("output").innerText +=("\nPEN " + arraygoeshere[fjdsa+1] + " DONE");
      break;
      case "GOTO": 
        goto(mafs(arraygoeshere[fjdsa+1]),mafs(arraygoeshere[fjdsa+2]));
        document.getElementById("output").innerText += ("\nWent to x" + mafs(arraygoeshere[fjdsa+1]) + ", y" + mafs(arraygoeshere[fjdsa+2]));
      break;
      case "ANGLE": 
        angle(mafs(arraygoeshere[fjdsa+1]));
        document.getElementById("output").innerText +=("\nTurned " + mafs(arraygoeshere[fjdsa+1]) + " deg.");
      break;
      case "RESET":
      init();
        document.getElementById("output").innerText += ("\nReset!");
      break;
      case "CLEAR":
      pen.fillStyle = "#d8e0d0";
        ctx.fillRect(0,0,256,256);
        document.getElementById("output").innerText += ("\nCanvas Cleared!");
      break;
      case "VAR":
      fakevar(arraygoeshere[fjdsa+1],mafs(arraygoeshere[fjdsa+2]),"is");
        document.getElementById("output").innerText += ("\nVariable " + arraygoeshere[fjdsa+1] + " is now " +arraygoeshere[fjdsa+2]);
      break;
      case "INC":
      fakevar(arraygoeshere[fjdsa+1],mafs(arraygoeshere[fjdsa+2]),"inc");
        document.getElementById("output").innerText += ("\nVariable " + arraygoeshere[fjdsa+1] + " has been increased by " + arraygoeshere[fjdsa+2] + " and now is " + getvar(arraygoeshere[fjdsa+1]));
      break;
      case "GET":
      getvar(arraygoeshere[fjdsa+1]);
        document.getElementById("output").innerText += ("\nVariable " + arraygoeshere[fjdsa+1] + " is " + getvar(arraygoeshere[fjdsa+1]));
      break;
      case "HELP":
      document.getElementById("output").innerText += "\nHelp is bad for the environment";
      break;
      case "THEN": //search for REPEAT, IF, or ELSE (ELSE searches for IF)
      for (i=j; i>=0; i--) {
        let leto = parse_line(i);
        if (leto[0] == "IF") {
          switch (leto[2]) {
            case ">": if (mafs(leto[1]) <= mafs(leto[3])) {fjdsa = 10000;} break;
            case "=": if (mafs(leto[1]) !== mafs(leto[3])) {fjdsa = 10000;} break;
            case "<": if (mafs(leto[1]) >= mafs(leto[3])) {fjdsa = 10000;} break;
            case "!=": if (mafs(leto[1]) == mafs(leto[3])) {fjdsa = 10000;} break;
            case "lim": if (mafs(leto[1]) < mafs(leto[3]) || mafs(leto[1]) > mafs(leto[4])) {fjdsa = 10000;} break;
          }
        } else if (leto[0] == "REPEAT") {
          thing_counter = mafs(leto[1])-1;
        } else if (leto[0] == "UNLESS") {
          switch (leto[2]) {
            case "<": if (mafs(leto[1]) < mafs(leto[3])) {fjdsa = 10000;} break;
            case "=": if (mafs(leto[1]) == mafs(leto[3])) {fjdsa = 10000;} break;
            case ">": if (mafs(leto[1]) > mafs(leto[3])) {fjdsa = 10000;} break;
            case "!=": if (mafs(leto[1]) !== mafs(leto[3])) {fjdsa = 10000;} break;
            case "lim": if (mafs(leto[1]) > mafs(leto[3]) && mafs(leto[1]) < mafs(leto[4])) {fjdsa = 10000;} break;
          }
        }
      }
      break;
      case "PRINT":
      document.getElementById("output").innerText += ("\n" + arraygoeshere[fjdsa+1]);
      break;
      case "PRINTMAFS":
      document.getElementById("output").innerText += ("\n" + mafs(arraygoeshere[fjdsa+1]));
      break;
      case "WAIT": //fucked
      waitflag = mafs(arraygoeshere[fjdsa+1]);
      document.getElementById("output").innerText += ("\nSleeping for " + arraygoeshere[fjdsa+1]);
      break;
      default:
      break;
      //. works as a ;
    }
    if (fjdsa == arraygoeshere.length -1 && thing_counter > 0) {
      fjdsa = 0;
      thing_counter -= 1;
    }
    if (delayflag) {await sleep(100);}
  }
  drau();
}
function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms || 1000));
}
function drau() {
  ctx2.clearRect(0,0,256,256);
  ctx2.fillStyle = "#404048";
  ctx2.fillRect(pen.x-5,pen.y-5,10,10);
if (pen.down) {
  ctx.lineTo(pen.x,pen.y);
  ctx.stroke();
}
ctx.beginPath();
  ctx.moveTo(pen.x,pen.y);
}
function getvar(pa) {
for (i=0; i<the.length; i++) {
  if (the[i].page == pa) {
    return the[i].word;
  }
}
return "Unable to find";
}
function getvarindex(pa) {
for (i=0; i<the.length; i++) {
  if (the[i].page == pa) {
    return i;
  }
}
return "Unable to find";
}
function fakevar(pa,o,yn) {
  if (getvar(pa) == "Unable to find") {
    the.push({page:pa,word:o});
  } else {
    if (yn == "inc") {
      the[getvarindex(pa)].word += o;
    } else {
      the[getvarindex(pa)].word = o;
    }
  }
  return getvar(pa);
}
function mafs(func) {
  let kayasaki = func;
  let regex = /[A-Za-z]+/i;
  if (func.includes("(")) {
    for (i=0; i<the.length; i++) {
      kayasaki = kayasaki.replaceAll(the[i].page, "getvar(\"" +the[i].page+ "\")");
      console.log(kayasaki);
    }
    return eval(kayasaki);//unsafe af but who cares
  } else if (regex.test(func)) {
    return getvar(func);
  } else {
    return parseFloat(func);
  }
}
//Functions to make my programming language work
function init() {
  pen.fillStyle = "#d8e0d0";
  ctx.fillRect(0,0,256,256);
 pen = {
  x:128,y:128,th:0,down:false
}
the = [
  {page:"test",word:0},
   {page:"px",word:0},
    {page:"py",word:0},
     {page:"func-ct",word:0},
];
waitflag = 0;
thing_counter = 0;
}
function move(px) {
  drau();//temp
pen.x -= px * Math.sin(pen.th);
pen.y -= px * Math.cos(pen.th);
}
function turn(d) {
  pen.th += -1/180*Math.PI*d;
}
function angle(d) {
  pen.th = -1/180*Math.PI*d;
}
function goto(a,b) {
  pen.x = a;
  pen.y = b;
}
function rin(g) {
  switch (g) {
    case "UP": pen.down = false; break;
    case "DOWN": pen.down = true; break;
    case "TOGGLE": pen.down = !pen.down; break;
    case "WHITE": ctx.strokeColor = "#d8e0d0"; break;
    case "BLACK": ctx.strokeColor = "#404048"; break;
    default: ctx.lineWidth = mafs(g); break;
  }
}
function toggle_output() {
   if (document.getElementById("output").style.display == "block") {
      document.getElementById("output").style.display = "none";
   } else {
      document.getElementById("output").style.display = "block";
   }
}
function toggle_pointer() {
   if (document.getElementById("artf").style.display == "block") {
      document.getElementById("artf").style.display = "none";
   } else {
      document.getElementById("artf").style.display = "block";
   }
}
</script>
